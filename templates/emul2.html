<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DE2 Emulator</title>
  <!-- MDB icon -->
  <!-- <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon"> -->
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="static/css/bootstrap.min.css">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="static/css/mdb.min.css">
  <!-- Your custom styles (optional) -->
  <link rel="stylesheet" href="static/css/style.css">
</head>
<body>

    
    <!--Main Navigation-->
    <header>
        
        <!--Navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark primary-color">

            <!-- Navbar brand -->
            <a class="navbar-brand" href="#">DE2 Emulator</a>
        
            <!-- Collapse button -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav" aria-controls="basicExampleNav"
                aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        
            <!-- Collapsible content -->
            <div class="collapse navbar-collapse" id="basicExampleNav">
        
                <!-- Links -->
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Send File(s)
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Emulation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Editor</a>
                    </li>
        
                    <!-- Dropdown -->
                    <!-- <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                        <div class="dropdown-menu dropdown-primary" aria-labelledby="navbarDropdownMenuLink">
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </li> -->
        
                </ul>
        
            </div>
            <!-- Collapsible content -->
        
        </nav>
    <!--/.Navbar-->

    </header>
    <!--Main Navigation-->

    <!--Main layout-->
    <main>

        <div class="container mt-5">
            Your <strong>id</strong> is {{ username }}.        
        </div>

        {%- if filenames is defined -%}
        <div class="container mt-4">
            Files in your folder:
            <ul>
                
                    {% for file in filenames %}
                        <li><a href="{{ user.url }}">{{ user.username }}</a></li>
                    {% endfor %}                
            </ul>
        </div>
        {% endif %}

        <div class="container mt-3">
 
            <form class="md-form" id="meuform" enctype="multipart/form-data">
                <div class="file-field">
                  <div class="btn btn-primary btn-sm float-left">
                    <span>Choose file(s)</span>
                    <input type="file" name="fileToUpload" id="fileToUpload" accept=".vhd,.vhdl" multiple>
                  </div>
                  <!-- <div class="file-path-wrapper">
                    <input class="file-path validate" type="text" placeholder="Upload your file">
                  </div> -->
                </div>
                <button type="button" class="btn btn-primary p-2" onclick="uploadfile();">Upload and Compile</button>
            </form>

        </div>

        <div class="container mt-3">

            <div id="status">
    
            </div>
    
        </div>

    </main>
    <!--Main layout-->

    <!--Footer-->
    <footer>

    </footer>
    <!--Footer-->

    <!-- jQuery -->
    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="static/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="static/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="static/js/mdb.min.js"></script>
    <!-- Socket.IO: -->
    <script src="/static/socket.io.js"></script>
    <!-- Your custom scripts (optional) -->
    <script type="text/javascript">

        function uploadfile() {  

            var fdata = new FormData( $("#meuform").get(0) );
            // var ajaxUrl = "process-upload.php";				
            $.ajax({
                url : 'upload',
                type : "POST",
                data : fdata,
                // both 'contentType' and 'processData' parameters are
                // required so that all data are correctly transferred
                contentType : false,
                processData : false
            }).done(function(response){
                if (response == "Done!") {
                    $("#status").html("<br>File(s) sent.");
                    fpgaCompile();
                }                
                // In this callback you get the AJAX response to check
                // if everything is right...
            }).fail(function(response){
                // Here you should treat the http errors (e.g., 403, 404)
                $("#status").html(response);
            }).always(function(){
                // alert("AJAX request finished!");
            });

        }

        function fpgaCompile() {
            var socket = io.connect('http://' + document.domain + ':' + location.port + '/stream')
            socket.send("Compile")
            socket.on('message', function(msg){                
                $('#status').append('<br>'+String(msg));
            });
            socket.on('errors', function(msg){
                $('#status').append('<span style="text-color:red;"><br>Errors:<br>'+String(msg)+"</span>");
            });
            socket.on('success',function(msg){
                $('#status').append(`
                    <br><span style="color:blue;">
                        Compilation successful!<br>
                        You can now start your emulation.
                    </span>
                `);
            });
        }
        
    </script>

</body>
</html>